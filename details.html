<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Booking Details - Dervesh Cargo Services</title>
  <style>
    body { font-family: Arial, sans-serif; background: #eef2f7; }
    h2 { text-align: center; color: #333; }
    table { width: 95%; margin: 20px auto; border-collapse: collapse; background: white; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background: #007bff; color: white; }
    button { background: #28a745; color: white; border: none; padding: 6px 12px; cursor: pointer; border-radius: 4px; }
    button:hover { background: #218838; }
    .search-box { width: 90%; margin: 15px auto; text-align: center; }
    .search-box input { width: 60%; padding: 8px; border-radius: 6px; border: 1px solid #ccc; }
  </style>
</head>
<body>

  <h2>Booking Details</h2>

  <div class="search-box">
    <input type="text" id="search" placeholder="Search by Bilty No, Date, or Name...">
  </div>

  <table id="detailsTable">
    <thead>
      <tr>
        <th>Bilty No</th>
        <th>Date</th>
        <th>Sender</th>
        <th>Receiver</th>
        <th>Vehicle</th>
        <th>Driver</th>
        <th>Weight</th>
        <th>Qty</th>
        <th>Price</th>
        <th>Pickup</th>
        <th>Drop</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    function loadBookings() {
      let bookings = JSON.parse(localStorage.getItem("bookings")) || [];
      let tbody = document.querySelector("#detailsTable tbody");
      tbody.innerHTML = "";

      bookings.forEach(b => {
        let row = `
          <tr>
            <td>${b.biltyNo}</td>
            <td>${b.date}</td>
            <td>${b.sender}</td>
            <td>${b.receiver}</td>
            <td>${b.vehicle}</td>
            <td>${b.driver} (${b.driverPhone})</td>
            <td>${b.weight}</td>
            <td>${b.qty}</td>
            <td>${b.price}</td>
            <td>${b.pickup}</td>
            <td>${b.drop}</td>
            <td><button onclick="printSlip('${b.biltyNo}')">Print</button></td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
    }

    function printSlip(biltyNo) {
      let bookings = JSON.parse(localStorage.getItem("bookings")) || [];
      let b = bookings.find(x => x.biltyNo === biltyNo);

      let slip = `
        <h2>Dervesh Cargo Services</h2>
        <p><b>Bilty No:</b> ${b.biltyNo}</p>
        <p><b>Date:</b> ${b.date}</p>
        <p><b>Sender:</b> ${b.sender}</p>
        <p><b>Receiver:</b> ${b.receiver}</p>
        <p><b>Vehicle:</b> ${b.vehicle}</p>
        <p><b>Driver:</b> ${b.driver} (${b.driverPhone})</p>
        <p><b>Weight:</b> ${b.weight}</p>
        <p><b>Quantity:</b> ${b.qty}</p>
        <p><b>Price:</b> ${b.price}</p>
        <p><b>Pickup:</b> ${b.pickup}</p>
        <p><b>Drop:</b> ${b.drop}</p>
        <p><b>Remarks:</b> ${b.remarks}</p>
      `;

      let w = window.open("", "", "width=600,height=400");
      w.document.write(slip);
      w.print();
    }

    // Search filter
    document.getElementById("search").addEventListener("keyup", function() {
      let value = this.value.toLowerCase();
      let rows = document.querySelectorAll("#detailsTable tbody tr");
      rows.forEach(row => {
        row.style.display = row.innerText.toLowerCase().includes(value) ? "" : "none";
      });
    });

    window.onload = loadBookings;
  </script>

</body>
</html>
